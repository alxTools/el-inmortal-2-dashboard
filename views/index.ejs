<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/dashboard.css">
</head>
<body>
    <%- include('partials/navbar') %>

    <header class="header">
        <h1>El Inmortal 2</h1>
        <div class="subtitle">Galante el Emperador</div>
        <div class="countdown-main">
            <div class="countdown-title">Lanzamiento en</div>
            <div class="countdown-time" id="main-countdown">
                <span id="main-days">--</span>d 
                <span id="main-hours">--</span>h 
                <span id="main-minutes">--</span>m
            </div>
        </div>
    </header>

    <% if (flash) { %>
    <section class="section" style="max-width: 1200px; margin: 16px auto 0;">
        <div style="background:#111827; border:1px solid #334155; color:#e5e7eb; border-radius:10px; padding:10px 12px; font-size:0.9rem;">
            <strong>Estado:</strong> <%= flash %>
        </div>
    </section>
    <% } %>

    <!-- DAILY TIMERS SECTION -->
    <section class="daily-timers-section">
        <h2 class="daily-timers-title">‚è∞ Conteo Regresivo por D√≠a</h2>
        <div class="timers-grid">
            <!-- D√≠a -2 -->
            <div class="timer-card" id="timer-day-minus-2">
                <div class="timer-label">D√≠a -2</div>
                <div class="timer-date">Dom 15 Feb - Pre-lanzamiento</div>
                <div class="timer-display">
                    <div class="timer-unit">
                        <span class="timer-number" id="tm2-days">--</span>
                        <div class="timer-text">D√≠as</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="tm2-hours">--</span>
                        <div class="timer-text">Horas</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="tm2-minutes">--</span>
                        <div class="timer-text">Mins</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="tm2-seconds">--</span>
                        <div class="timer-text">Segs</div>
                    </div>
                </div>
                <div class="timer-status status-upcoming" id="status-tm2">Pr√≥ximo</div>
            </div>

            <!-- D√≠a -1 -->
            <div class="timer-card" id="timer-day-minus-1">
                <div class="timer-label">D√≠a -1</div>
                <div class="timer-date">Lun 16 Feb - √öltimo Push</div>
                <div class="timer-display">
                    <div class="timer-unit">
                        <span class="timer-number" id="tm1-days">--</span>
                        <div class="timer-text">D√≠as</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="tm1-hours">--</span>
                        <div class="timer-text">Horas</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="tm1-minutes">--</span>
                        <div class="timer-text">Mins</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="tm1-seconds">--</span>
                        <div class="timer-text">Segs</div>
                    </div>
                </div>
                <div class="timer-status status-upcoming" id="status-tm1">Pr√≥ximo</div>
            </div>

            <!-- D√≠a 0 - LANZAMIENTO -->
            <div class="timer-card launch-timer" id="timer-day-0">
                <div class="timer-label">üöÄ D√çA 0</div>
                <div class="timer-date">Mar 17 Feb - LANZAMIENTO</div>
                <div class="timer-display">
                    <div class="timer-unit">
                        <span class="timer-number" id="t0-days">--</span>
                        <div class="timer-text">D√≠as</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="t0-hours">--</span>
                        <div class="timer-text">Horas</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="t0-minutes">--</span>
                        <div class="timer-text">Mins</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="t0-seconds">--</span>
                        <div class="timer-text">Segs</div>
                    </div>
                </div>
                <div class="timer-status status-upcoming" id="status-t0">‚è≥ Esperando...</div>
            </div>

            <!-- D√≠a 1 -->
            <div class="timer-card" id="timer-day-1">
                <div class="timer-label">D√≠a 1</div>
                <div class="timer-date">Mi√© 18 Feb - Post-lanzamiento</div>
                <div class="timer-display">
                    <div class="timer-unit">
                        <span class="timer-number" id="t1-days">--</span>
                        <div class="timer-text">D√≠as</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="t1-hours">--</span>
                        <div class="timer-text">Horas</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="t1-minutes">--</span>
                        <div class="timer-text">Mins</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="t1-seconds">--</span>
                        <div class="timer-text">Segs</div>
                    </div>
                </div>
                <div class="timer-status status-upcoming" id="status-t1">Pr√≥ximo</div>
            </div>

            <!-- Semana 1 -->
            <div class="timer-card" id="timer-day-7">
                <div class="timer-label">Semana 1</div>
                <div class="timer-date">Lun 24 Feb - Resumen</div>
                <div class="timer-display">
                    <div class="timer-unit">
                        <span class="timer-number" id="t7-days">--</span>
                        <div class="timer-text">D√≠as</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="t7-hours">--</span>
                        <div class="timer-text">Horas</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="t7-minutes">--</span>
                        <div class="timer-text">Mins</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="t7-seconds">--</span>
                        <div class="timer-text">Segs</div>
                    </div>
                </div>
                <div class="timer-status status-upcoming" id="status-t7">Pr√≥ximo</div>
            </div>

            <!-- D√≠a 21 -->
            <div class="timer-card" id="timer-day-21">
                <div class="timer-label">Fin de Campa√±a</div>
                <div class="timer-date">Lun 10 Mar - 21 d√≠as</div>
                <div class="timer-display">
                    <div class="timer-unit">
                        <span class="timer-number" id="t21-days">--</span>
                        <div class="timer-text">D√≠as</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="t21-hours">--</span>
                        <div class="timer-text">Horas</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="t21-minutes">--</span>
                        <div class="timer-text">Mins</div>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number" id="t21-seconds">--</span>
                        <div class="timer-text">Segs</div>
                    </div>
                </div>
                <div class="timer-status status-upcoming" id="status-t21">Pr√≥ximo</div>
            </div>
        </div>
    </section>

    <div class="container">
        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total de Temas</h3>
                <div class="number"><%= stats.totalTracks %>/<%= stats.totalTracksTarget %></div>
                <div class="label">Canciones en el √°lbum</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: <%= (stats.totalTracks / stats.totalTracksTarget * 100) %>"></div>
                </div>
            </div>
            <div class="stat-card">
                <h3>Productores</h3>
                <div class="number"><%= stats.producerCount %></div>
                <div class="label">Colaboradores</div>
            </div>
            <div class="stat-card">
                <h3>Splitsheets</h3>
                <div class="number"><%= stats.splitsheetsConfirmed %>/<%= stats.totalTracks %></div>
                <div class="label">Confirmados</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: <%= stats.totalTracks > 0 ? (stats.splitsheetsConfirmed / stats.totalTracks * 100) : 0 %>"></div>
                </div>
            </div>
            <div class="stat-card">
                <h3>Contenido</h3>
                <div class="number"><%= stats.totalContent %>/<%= stats.totalContentTarget %></div>
                <div class="label">Posts planeados</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: <%= (stats.totalContent / stats.totalContentTarget * 100) %>"></div>
                </div>
            </div>
        </div>

        <!-- Recent Tracks -->
        <section class="section">
            <div class="section-header">
                <h2><span class="section-icon">üéµ</span> Temas Recientes</h2>
                <a href="/tracks" class="btn">Ver Todos</a>
            </div>
            <table class="tracks-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>T√≠tulo</th>
                        <th>Productor</th>
                        <th>Splitsheet</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <% recentTracks.forEach(track => { %>
                    <tr>
                        <td><%= track.track_number %></td>
                        <td><strong><%= track.title || 'Sin t√≠tulo' %></strong></td>
                        <td><%= track.producer_name || 'Sin asignar' %></td>
                        <td>
                            <% if (track.splitsheet_confirmed) { %>
                                <span class="status-badge status-done">Confirmado</span>
                            <% } else if (track.splitsheet_sent) { %>
                                <span class="status-badge status-pending">Enviado</span>
                            <% } else { %>
                                <span class="status-badge status-urgent">Pendiente</span>
                            <% } %>
                        </td>
                        <td>
                            <a href="/tracks/<%= track.id %>/edit" class="btn-small">Editar</a>
                        </td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </section>

        <!-- Quick Links -->
        <section class="section">
            <div class="section-header">
                <h2><span class="section-icon">‚ö°</span> Acceso R√°pido</h2>
            </div>
            <div class="quick-links">
                <a href="/tracks/new" class="quick-link">
                    <div class="quick-link-icon">üéµ</div>
                    <div>+ Nuevo Tema</div>
                </a>
                <a href="/producers/new" class="quick-link">
                    <div class="quick-link-icon">üéß</div>
                    <div>+ Nuevo Productor</div>
                </a>
                <a href="/splitsheets" class="quick-link">
                    <div class="quick-link-icon">üìÑ</div>
                    <div>Splitsheets</div>
                </a>
                <a href="/calendar" class="quick-link">
                    <div class="quick-link-icon">üìÖ</div>
                    <div>Calendario</div>
                </a>
                <a href="/checklist" class="quick-link">
                    <div class="quick-link-icon">‚úÖ</div>
                    <div>Checklist</div>
                </a>
                <a href="/api/stats" target="_blank" class="quick-link">
                    <div class="quick-link-icon">üìä</div>
                    <div>API Stats</div>
                </a>
                <a href="/tools" class="quick-link">
                    <div class="quick-link-icon">üß∞</div>
                    <div>Tools</div>
                </a>
                <a href="/tools/thumbnail-generator" class="quick-link">
                    <div class="quick-link-icon">üñºÔ∏è</div>
                    <div>Thumbnail Generator</div>
                </a>
                <a href="/tools/youtube-metadata-audit" class="quick-link">
                    <div class="quick-link-icon">üì∫</div>
                    <div>YouTube Metadata Audit</div>
                </a>
                <a href="/tools/exports" class="quick-link">
                    <div class="quick-link-icon">üì¶</div>
                    <div>Exports</div>
                </a>
                <a href="/landing/el-inmortal-2" target="_blank" rel="noreferrer" class="quick-link">
                    <div class="quick-link-icon">üöÄ</div>
                    <div>Landing Publico</div>
                </a>
            </div>

            <div style="margin-top: 16px; padding: 12px; border: 1px solid #334155; border-radius: 10px; background: #0f172a;">
                <div style="font-weight: 700; margin-bottom: 8px; color: #e5e7eb;">Enviar Reporte Diario YouTube (PDF)</div>
                <form method="POST" action="/send-daily-report-email">
                    <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
                        <input type="email" name="email_to" value="<%= defaultReportEmailTo || '' %>" placeholder="destino@dominio.com" style="padding:8px 10px; border-radius:8px; border:1px solid #334155; background:#111827; color:#e5e7eb; min-width:260px;">
                        <input type="date" name="from" style="padding:8px 10px; border-radius:8px; border:1px solid #334155; background:#111827; color:#e5e7eb;">
                        <input type="date" name="to" style="padding:8px 10px; border-radius:8px; border:1px solid #334155; background:#111827; color:#e5e7eb;">
                        <button type="submit" class="btn">Enviar PDF por Email</button>
                    </div>
                </form>
            </div>
        </section>

        <section class="section">
            <div class="section-header">
                <h2><span class="section-icon">‚ú®</span> Features & Tools</h2>
                <a href="/tools" class="btn">Ver Todo</a>
            </div>
            <div class="quick-links">
                <a href="/tools/thumbnail-generator" class="quick-link">
                    <div class="quick-link-icon">üé¨</div>
                    <div>Generar Thumbnail desde Video</div>
                </a>
                <a href="/tools/youtube-metadata-audit" class="quick-link">
                    <div class="quick-link-icon">üì∫</div>
                    <div>Auditar y Corregir Metadata YouTube</div>
                </a>
                <a href="/tools/exports" class="quick-link">
                    <div class="quick-link-icon">üì¶</div>
                    <div>Descargar Exports</div>
                </a>
                <a href="/landing/el-inmortal-2" target="_blank" rel="noreferrer" class="quick-link">
                    <div class="quick-link-icon">üöÄ</div>
                    <div>Abrir Landing del Album</div>
                </a>
            </div>
        </section>
    </div>

    <%- include('partials/footer') %>

    <script src="/js/dashboard.js"></script>
    <script>
        // Real-time countdown updates
        function updateCountdown() {
            fetch('/api/countdown')
                .then(response => response.json())
                .then(data => {
                    // Update main countdown
                    const launchTimer = data.timers.t0;
                    document.getElementById('main-days').textContent = launchTimer.days;
                    document.getElementById('main-hours').textContent = launchTimer.hours;
                    document.getElementById('main-minutes').textContent = launchTimer.minutes;

                    // Update daily timers
                    for (const [key, timer] of Object.entries(data.timers)) {
                        const daysEl = document.getElementById(`${key}-days`);
                        if (daysEl) {
                            daysEl.textContent = String(timer.days).padStart(2, '0');
                            document.getElementById(`${key}-hours`).textContent = String(timer.hours).padStart(2, '0');
                            document.getElementById(`${key}-minutes`).textContent = String(timer.minutes).padStart(2, '0');
                            document.getElementById(`${key}-seconds`).textContent = String(timer.seconds).padStart(2, '0');

                            // Update status
                            const statusEl = document.getElementById(`status-${key}`);
                            if (timer.isActive) {
                                statusEl.textContent = key === 't0' ? 'üéâ ¬°LANZAMIENTO ACTIVO!' : '‚ú® D√≠a Activo';
                                statusEl.className = 'timer-status status-active';
                            } else if (timer.isPast) {
                                statusEl.textContent = key === 't0' ? 'üöÄ LANZADO' : '‚úì Completado';
                                statusEl.className = 'timer-status status-launched';
                            } else if (timer.days === 0 && timer.hours < 24) {
                                statusEl.textContent = 'üî• Menos de 24h!';
                                statusEl.className = 'timer-status status-active';
                            }
                        }
                    }
                })
                .catch(error => console.error('Error updating countdown:', error));
        }

        // Update every second
        updateCountdown();
        setInterval(updateCountdown, 1000);
    </script>
</body>
</html>
